# üîç Groq Vision API Integration

This document describes the integration of Groq's Vision API for analyzing quaternion attractor PNG images generated by this project.

## üìã Overview

The Groq Vision integration allows you to:
- Analyze individual quaternion attractor images
- Compare multiple attractor variations
- Batch analyze directories of PNG files
- Generate mathematical insights about the visual patterns
- Save analysis results in structured JSON format

## üöÄ Quick Start

### 1. Environment Setup

Copy the `.env.example` file to `.env` and add your API key:

```bash
# Copy the template
cp .env.example .env

# Edit .env and add your actual API key
# Get your API key from: https://console.groq.com/keys
```

The `.env.example` template contains:
```bash
# Groq API Configuration
# Get your API key from: https://console.groq.com/keys
GROQ_API_KEY=your_groq_api_key_here

# Vision model for analyzing PNG images
# Available models: meta-llama/llama-4-scout-17b-16e-instruct
GROQ_VISION_MODEL=meta-llama/llama-4-scout-17b-16e-instruct
```

### 2. Dependencies

The required packages are already installed:
- `groq-sdk`: Official Groq SDK
- `dotenv`: Environment variable management

### 3. Basic Usage

```bash
# Test the integration
npm run test:groq

# Run full analysis examples
npm run example:groq
```

## üõ†Ô∏è API Reference

### GroqVisionAnalyzer Class

#### Constructor
```typescript
const analyzer = new GroqVisionAnalyzer();
```

#### Methods

##### `analyzeImage(imagePath: string, options?: AnalysisOptions)`
Analyzes a single PNG image.

**Parameters:**
- `imagePath`: Path to the PNG file
- `options`: Optional analysis configuration
  - `prompt`: Custom analysis prompt
  - `model`: Specific model to use
  - `maxTokens`: Maximum response length
  - `temperature`: Response creativity (0.0-1.0)

**Returns:** `Promise<VisionAnalysisResult>`

##### `analyzeDirectory(directoryPath: string, options?: AnalysisOptions)`
Analyzes all PNG files in a directory.

**Parameters:**
- `directoryPath`: Path to directory containing PNG files
- `options`: Analysis configuration (same as above)

**Returns:** `Promise<VisionAnalysisResult[]>`

##### `compareImages(imagePaths: string[], options?: AnalysisOptions)`
Compares multiple images and provides comparative analysis.

**Parameters:**
- `imagePaths`: Array of image file paths
- `options`: Analysis configuration

**Returns:** `Promise<VisionAnalysisResult>`

##### `saveAnalysisResults(results, outputPath: string)`
Saves analysis results to a JSON file.

**Parameters:**
- `results`: Single result or array of results
- `outputPath`: Path where to save the JSON file

## üìä Example Usage

### Single Image Analysis

```typescript
import { GroqVisionAnalyzer } from '../typescript/node/groq-vision-analyzer';

const analyzer = new GroqVisionAnalyzer();

const result = await analyzer.analyzeImage('output/png_examples/basic_attractor.png', {
  prompt: 'Analyze this quaternion attractor pattern. Focus on mathematical properties and visual complexity.',
  maxTokens: 800,
  temperature: 0.5,
});

if (result.success) {
  console.log('Analysis:', result.analysis);
} else {
  console.error('Error:', result.error);
}
```

### Batch Directory Analysis

```typescript
const results = await analyzer.analyzeDirectory('output/png_examples/variations', {
  prompt: 'Analyze this attractor variation and describe its unique characteristics.',
  maxTokens: 600,
});

// Save results
await analyzer.saveAnalysisResults(results, 'output/variation_analysis.json');
```

### Comparative Analysis

```typescript
const imagePaths = [
  'output/png_examples/variations/plain_flip.png',
  'output/png_examples/variations/flip_smallest.png',
  'output/png_examples/variations/flip_all_except_largest.png',
];

const comparison = await analyzer.compareImages(imagePaths, {
  prompt: 'Compare these attractor variations and identify the key differences.',
  maxTokens: 1200,
});
```

## üéØ Analysis Prompts

### Mathematical Analysis
```typescript
const mathematicalPrompt = `As a mathematician specializing in dynamical systems and quaternion algebra, analyze this attractor visualization:

1. Identify the type of attractor (strange, periodic, fixed point, etc.)
2. Describe the fractal dimension and self-similarity properties
3. Analyze the symmetry groups present in the pattern
4. Estimate the Lyapunov exponents based on the visual complexity
5. Suggest mathematical parameters that might generate similar patterns
6. Compare this to known attractors (Lorenz, R√∂ssler, etc.)

Provide a rigorous mathematical analysis suitable for a research paper.`;
```

### Visual Pattern Analysis
```typescript
const visualPrompt = `Analyze this mathematical visualization image. This appears to be a quaternion attractor pattern generated from 4D quaternion dynamics projected to 2D. Please describe:

1. The overall visual pattern and structure
2. Any symmetries or geometric features you observe
3. The color distribution and intensity patterns
4. Any mathematical or fractal-like properties
5. The complexity and density of the pattern
6. Any interesting visual characteristics that might relate to the underlying mathematical system

Be specific about the visual elements and provide insights that could be useful for understanding the mathematical properties of this attractor.`;
```

## üìÅ Output Format

Analysis results are saved in structured JSON format:

```json
{
  "timestamp": "2025-10-04T23:51:55.685Z",
  "results": [
    {
      "success": true,
      "analysis": "Detailed analysis text...",
      "model": "meta-llama/llama-4-scout-17b-16e-instruct",
      "imagePath": "/path/to/image.png",
      "timestamp": "2025-10-04T23:51:55.683Z"
    }
  ],
  "summary": {
    "totalImages": 1,
    "successfulAnalyses": 1,
    "failedAnalyses": 0
  }
}
```

## üîß Configuration

### Model Selection

The default model is `meta-llama/llama-4-scout-17b-16e-instruct`, which is optimized for vision tasks. You can override this in the `.env` file or per-request:

```bash
# In .env file (copy from .env.example first)
GROQ_VISION_MODEL=your-preferred-model

# Or in code
const result = await analyzer.analyzeImage(imagePath, {
  model: 'different-model-name'
});
```

### Rate Limiting

The analyzer includes built-in rate limiting with 1-second delays between requests when processing multiple images to avoid API limits.

## üß™ Testing

### Quick Test
```bash
npm run test:groq
```

This runs a simple test with the basic attractor image and saves the result to `output/groq_test_result.json`.

### Full Example Suite
```bash
npm run example:groq
```

This runs comprehensive examples including:
- Single image analysis
- Variation comparison
- Animation frame analysis
- Mathematical analysis
- Batch processing

## üìà Performance

- **Single Image**: ~2-5 seconds per analysis
- **Batch Processing**: ~1-2 seconds per image (with rate limiting)
- **File Size**: Analysis results are typically 1-3KB per image
- **API Limits**: Respects Groq's rate limits with built-in delays

## üîç Troubleshooting

### Common Issues

1. **API Key Error**: Ensure your `.env` file contains a valid `GROQ_API_KEY`
2. **Image Not Found**: Verify the image path exists and is accessible
3. **Rate Limiting**: The analyzer includes delays, but you may need to increase them for large batches
4. **Model Errors**: Check that the specified model supports vision tasks

### Debug Mode

Enable detailed logging by setting:
```bash
DEBUG=groq-vision-analyzer
```

## üéâ Success Example

Here's what a successful analysis looks like:

```
‚úÖ Analysis successful!
üìä Model: meta-llama/llama-4-scout-17b-16e-instruct
‚è∞ Timestamp: 2025-10-04T23:51:55.683Z
üìù Analysis:
The image depicts a scatter plot of points that form a distinctive pattern, resembling a checkmark or a tick. The points are densely clustered at the bottom right and gradually become more sparse as they extend upward and to the left, forming a V-shape.

**Pattern Description:**
- The pattern appears to be a type of fractal or iterative sequence.
- It exhibits self-similarity, with smaller segments resembling the larger structure.
- The density of points decreases as you move from the bottom right to the top left of the pattern.

**Mathematical Significance:**
- This pattern is likely related to the Mandelbrot set or a similar mathematical concept.
- The exact nature of the pattern cannot be determined without additional context or information about the underlying mathematical function used to generate it.
```

## üîó Related Files

- `src/typescript/node/groq-vision-analyzer.ts` - Main analyzer class
- `src/examples/groq-vision-analysis-example.ts` - Comprehensive examples
- `src/examples/test-groq-integration.ts` - Simple test script
- `.env` - API configuration
- `output/groq_test_result.json` - Test results

---

*This integration enables powerful AI-driven analysis of your quaternion attractor visualizations, providing insights that can help optimize parameters and understand the mathematical properties of the generated patterns.*
